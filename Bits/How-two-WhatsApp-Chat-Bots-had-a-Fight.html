<!DOCTYPE html>
<html lang="en"><head><title>How two WhatsApp Chat Bots had a Fight</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:title" content="How two WhatsApp Chat Bots had a Fight"/><meta property="og:description" content="Would you like to know how two Whatsapp chat bots had a fight? Being an engineer at a tech startup, you get to witness many strange occurrences. This is one of the funniest I’ve come across."/><meta property="og:image" content="https://tabaza.dev/static/og-image.png"/><meta property="og:width" content="1200"/><meta property="og:height" content="675"/><link rel="icon" href="../static/icon.png"/><meta name="description" content="Would you like to know how two Whatsapp chat bots had a fight? Being an engineer at a tech startup, you get to witness many strange occurrences. This is one of the funniest I’ve come across."/><meta name="generator" content="Quartz"/><link href="../index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../static/contentIndex.json").then(data => data.json())</script></head><body data-slug="Bits/How-two-WhatsApp-Chat-Bots-had-a-Fight"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h1 class="page-title"><a href="..">Mohammad Tabaza</a></h1><div class="spacer mobile-only"></div><div class="search"><div id="search-icon"><p>Search</p><div></div><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search</title><desc id="desc">Search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></div><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><div class="darkmode"><input class="toggle" id="darkmode-toggle" type="checkbox" tabindex="-1"/><label id="toggle-label-light" for="darkmode-toggle" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg></label><label id="toggle-label-dark" for="darkmode-toggle" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></label></div><div class="explorer desktop-only"><button type="button" id="explorer" data-behavior="collapse" data-collapsed="collapsed" data-savestate="true" data-tree="[{&quot;path&quot;:&quot;Bits&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Blog&quot;,&quot;collapsed&quot;:true}]"><h1>Explorer</h1><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-content"><ul class="overflow" id="explorer-ul"><li><div class="folder-outer open"><ul style="padding-left:0;" class="content" data-folderul><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Bits"><button class="folder-button"><span class="folder-title">Bits</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Bits"><li><a href="../Bits/I-Hope-Swift-Wins" data-for="Bits/I-Hope-Swift-Wins">I Hope Swift Wins</a></li><li><a href="../Bits/Atlas-Is-the-Best-DB-Migration-Tool" data-for="Bits/Atlas-Is-the-Best-DB-Migration-Tool">Atlas Is the Best DB Migration Tool</a></li><li><a href="../Bits/Do-Not-Re-Invent-the-Wheel" data-for="Bits/Do-Not-Re-Invent-the-Wheel">Do Not Re-Invent the Wheel</a></li><li><a href="../Bits/Mindless-Learning" data-for="Bits/Mindless-Learning">Mindless Learning</a></li><li><a href="../Bits/How-two-WhatsApp-Chat-Bots-had-a-Fight" data-for="Bits/How-two-WhatsApp-Chat-Bots-had-a-Fight">How two WhatsApp Chat Bots had a Fight</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Blog"><button class="folder-button"><span class="folder-title">Blog</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Blog"><li><a href="../Blog/DevOps---The-Simple-Version" data-for="Blog/DevOps---The-Simple-Version">DevOps - The Simple Version</a></li><li><a href="../Blog/Functional-Programming---The-Simple-Version" data-for="Blog/Functional-Programming---The-Simple-Version">Functional Programming - The Simple Version</a></li><li><a href="../Blog/A-Guide-to-Scala-3" data-for="Blog/A-Guide-to-Scala-3">A Guide to Scala 3</a></li><li><a href="../Blog/The-Scala-Collections-Library" data-for="Blog/The-Scala-Collections-Library">The Scala Collections Library</a></li><li><a href="../Blog/Parsing-The-World-with-Rust-and-POM" data-for="Blog/Parsing-The-World-with-Rust-and-POM">Parsing The World with Rust and POM</a></li><li><a href="../Blog/Machine-Learning---From-Zero-to-Slightly-Less-Confused" data-for="Blog/Machine-Learning---From-Zero-to-Slightly-Less-Confused">Machine Learning - From Zero to Slightly Less Confused</a></li><li><a href="../Blog/RxJS-From-Scratch" data-for="Blog/RxJS-From-Scratch">RxJS From Scratch</a></li><li><a href="../Blog/FeathersJS-For-The-Beginner---Hello-World!" data-for="Blog/FeathersJS-For-The-Beginner---Hello-World!">FeathersJS For The Beginner - Hello World!</a></li><li><a href="../Blog/FeathersJS-For-The-Beginner---Basic-concepts" data-for="Blog/FeathersJS-For-The-Beginner---Basic-concepts">FeathersJS For The Beginner - Basic concepts</a></li></ul></div></li><li><div class="folder-outer "><ul style="padding-left:0;" class="content" data-folderul></ul></div></li></ul></div></li><li id="explorer-end"></li></ul></div></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../Bits/">Bits</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>How two WhatsApp Chat Bots had a Fight</a></div></nav><h1 class="article-title">How two WhatsApp Chat Bots had a Fight</h1><p show-comma="true" class="content-meta"><span>Oct 14, 2022</span><span>3 min read</span></p></div></div><article class="popover-hint"><p>Would you like to know how two Whatsapp chat bots had a fight?</p>
<p>Being an engineer at a tech startup, you get to witness many strange occurrences. This is one of the funniest I’ve come across.</p>
<p>BusinessChat.io is a customer support and marketing platform over Whatsapp. We have a chat bot engine, and a marketing campaigns module that lets our users send a message to tens of thousands of their customers with the click of a button. Our user uploads a list of contacts, assigns them to a group, and reaches out to all of them simply by picking a message template, and hitting “Send”.</p>
<p>When a contact replies to a marketing message, they enter a conversation with the chat bot. Whatsapp bots usually reply with quick-reply messages, which are interactive messages that have buttons the contact can tap to let the bot know what they want. So for example, the bot might ask the contact: “How can I help you today?”, with buttons saying “Talk to customer support” and “Find our nearest branch”.</p>
<p>With BusinessChat, if the bot prompts you to tap a button and you respond with something it doesn’t understand (i.e. text different from any of the buttons it expects you to click) the bot will reply to you with “Sorry, I don’t understand” and will once again prompt you to click one of the buttons.</p>
<p>So, one peaceful day, a colleague of mine taps me on the shoulder and says “There’s a conversation that takes forever to load.”</p>
<p>For some context, in BusinessChat, a conversation is a sequence of events and messages exchanged between a business and one of its contacts. You can load the conversation for a specific contact in the UI. Since the beginning of the project, we thought these messages and events weren’t worth paginating or lazy-loading, since the longest conversation ever made is about 500 messages long, and messages aren’t large at all. So for the longest time now, conversation loading without pagination has been fast and cheap.</p>
<p>My colleague and I began our investigation. We started by checking out the number of messages in the troublesome conversation, and to our surprise, it had 90,000 messages.</p>
<p>My mind started generating hypotheses. “Is there a bug in the retry logic that infinitely tries to send a failed message? No, it’s hard-coded to retry 3 times only” and “Is there an infinite loop in one of the bots? Impossible, I validate that bots have no invalid cycles.”</p>
<p>About five stressful minute into the investigation, all doubts were erased when we saw the actual content of the conversation. It was entirely made of messages saying “Sorry, I don’t understand”, sent not only from our bot, but also the other number. It was two bots telling each other they couldn’t understand one another 45,000 times.</p>
<p>What triggered this battle of bots was that one of our users had imported a list of contacts where one of the numbers was connected to a bot. When the user started a marketing campaign, and sent a message to this number, war began and lasted 3 hours until, presumably, someone turned off the other bot.</p>
<p>I would like to believe that someone really did notice the infinite loop and turned off the bot. The alternative would be that our bot took down their service, which I really hope wasn’t the case.</p></article></div><div class="right sidebar"></div></div><footer class><hr/><ul><li><a href="https://x.com/_tabaza">X</a></li><li><a href="https://www.linkedin.com/in/muhammad-tabaza/">LinkedIn</a></li><li><a href="https://github.com/m-tabaza/">GitHub</a></li><li><a href="https://tabaza.dev/index.xml">RSS</a></li></ul></footer></div></body><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js" type="application/javascript"></script><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script type="module">
          let mermaidImport = undefined
          document.addEventListener('nav', async () => {
            if (document.querySelector("code.mermaid")) {
              mermaidImport ||= await import('https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.7.0/mermaid.esm.min.mjs')
              const mermaid = mermaidImport.default
              const darkMode = document.documentElement.getAttribute('saved-theme') === 'dark'
              mermaid.initialize({
                startOnLoad: false,
                securityLevel: 'loose',
                theme: darkMode ? 'dark' : 'default'
              })

              await mermaid.run({
                querySelector: '.mermaid'
              })
            }
          });
          </script><script src="../postscript.js" type="module"></script></html>